<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Mi-Long</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
</head>

<body>
    <div class="main-container">
        <div id="hamburger"><img src="images/menu-icon.svg" width="80px" height="50px"></div>

        <div class="mainContent">
            <div class="outer-cirlce-container">
                <div class="circle-container">
                    <div class="pulsating-circle"></div>
                    <div class="solid-circle"></div>
                </div>
                <div class="outer-pulsating-circle"></div>
            </div>
        </div>
    <button id="record">Record</button>
    <audio id="audioPlayback" controls></audio>
    <p id="translatedText"></p>

    <script>
        const recordButton = document.getElementById('record');
        const audioPlayback = document.getElementById('audioPlayback');
        const translatedText = document.getElementById('translatedText');
        let mediaRecorder;
        let audioChunks = [];
        
        recordButton.addEventListener('click', () => {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();
                    audioChunks = [];

                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const formData = new FormData();
                        formData.append('file', audioBlob, 'audio.wav');

                        // Send the audio to the Flask server
                        fetch('/translate', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            translatedText.innerText = data.translated_text;
                            audioPlayback.src = data.audio + '?t=' + new Date().getTime();
                        })
                        .catch(err => console.error(err));
                    };

                    setTimeout(() => {
                        mediaRecorder.stop();
                    }, 3000);  // Record for 3 seconds
                });
        });
    </script>
        <div class="bottomContent">
            <div class="translate-container">
                <div class="language-section">
                    <button id="from-language-btn" class="language-button">
                        English
                    </button>
                    
                    <div class="arrow">&#x2195;</div>
                    
                    <button id="to-language-btn" class="language-button">
                        Mandarin
                    </button>
                </div>
                
                <button id="translate-btn">Translate</button>
            </div>
        
            <div id="languageModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <input class="search-bar" type="text" placeholder="Search">
                    <ul class="language-list">
                        <li>English</li>
                        <li>German</li>
                        <li>Mandarin</li>
                    </ul>
                </div>
            </div>
        </div>

    </div>

    <script src="script.js" defer></script>
</body>
</html>
