<html>
    <head>
        <meta charset="utf-8">
        <title>Mi-Long</title>
        <link rel="stylesheet" href="styles.css"> <!-- Link to your CSS file -->
        <!-- <link rel="icon" href="favicon.ico" type="image/x-icon"> Favicon -->
    </head>
    <body>
        <div id="hamburger"><image src="images/menu-icon.svg" width="100px" height="100px"></image>></div>
        <div class="outer-cirlce-container">
            <div class="circle-container">
                <div class="pulsating-circle"></div>
                <div class="solid-circle"></div>
            </div>
            <div class="outer-pulsating-circle"></div>
        </div>
        <label for="languages"></label>
        <select name="languages" id="cars">
            <option value="english">English</option>
            <option value="german">German</option>
            <option value="mandarin">Mandarin</option>
        </select>
        <br>
        <label for="languages"></label>
        <select name="languages" id="cars">
            <option value="english">English</option>
            <option value="german">German</option>
            <option value="mandarin">Mandarin</option>
        </select>
        <h1>Voice Translation</h1>
    <button id="record">Record</button>
    <audio id="audioPlayback" controls></audio>
    <p id="translatedText"></p>

    <script>
        const recordButton = document.getElementById('record');
        const audioPlayback = document.getElementById('audioPlayback');
        const translatedText = document.getElementById('translatedText');
        let mediaRecorder;
        let audioChunks = [];
        
        recordButton.addEventListener('click', () => {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();
                    audioChunks = [];

                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const formData = new FormData();
                        formData.append('file', audioBlob, 'audio.wav');

                        // Send the audio to the Flask server
                        fetch('/translate', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            translatedText.innerText = data.translated_text;
                            audioPlayback.src = data.audio + '?t=' + new Date().getTime();
                        })
                        .catch(err => console.error(err));
                    };

                    setTimeout(() => {
                        mediaRecorder.stop();
                    }, 3000);  // Record for 3 seconds
                });
        });
    </script>
    </body>

    <script src="script.js" defer></script> <!-- Link to your JavaScript file -->
</html>